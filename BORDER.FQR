      SUBROUTINE BORDER(N,A,IPERM)                                              C----- ORDER SET OF NUMBERS BY PERMUTATION INDEX                                C----- WRITTEN BY AL VACHRIS.. ADAPTED FROM A ROUTINE                           C----- ORDER WRITTEN BY FRANK NOLAN                                             C-----  FOR AORDER2  DIMENSION OF IPERM MUST BE AT LEAST TWICE DIMENSION        C-----  OF A                                                                          DIMENSION IPERM(N),A(N)                                                         LOGICAL LTEST                                                                   IF(N.EQ.0) GO TO 900                                                      C----- INITIALIZATION                                                                 NLAST=IABS(N)                                                                   IONE=NLAST+1                                                                    ITWO=IONE                                                                       NEW=1                                                                           ANEW=A(1)                                                                       IPERM(IONE)=1                                                                   INSET=IONE                                                                      ALOW=ANEW                                                                       AHIGH=ANEW                                                                C-----  MAJOR LOOP FOR LO-TO-HI SORT PERMUTATION                                  110 IF(NEW.GE.NLAST) GO TO 410                                                      AINSET=ANEW                                                                     NEW=NEW+1                                                                       ANEW=A(NEW)                                                               C-----  CHECK LOW END FOR TACK ON                                                     IF(ANEW.GE.ALOW) GO TO 120                                                      IONE=IONE-1                                                                     IPERM(IONE)=NEW                                                                 INSET=IONE                                                                      ALOW=ANEW                                                                       GO TO 110                                                                 C-----  CHECK HIGH END FOR TACK ON                                                120 IF(ANEW.LT.AHIGH) GO TO 210                                                     ITWO=ITWO+1                                                                     IPERM(ITWO)=NEW                                                                 INSET=ITWO                                                                      AHIGH=ANEW                                                                      GO TO 110                                                                 C----- INITIALIZE SEARCH BASED ON LAST INSERTION                                  210 JLOW=IONE                                                                       JHIGH=INSET                                                                     IF(ANEW.LT.AINSET) GO TO 220                                                    JLOW=INSET                                                                      JHIGH=ITWO                                                                C----- BINARY SEARCH LOOP TO LOCALIZE INSERTION POINT                             220 IF(JHIGH-JLOW.LT.10) GO TO 310                                                  INSET=(JLOW+JHIGH)/2                                                            INDEX=IPERM(INSET)                                                              LTEST=A(INDEX).GT.ANEW                                                          IF(LTEST)JHIGH=INSET                                                            IF(.NOT.LTEST)JLOW=INSET                                                        GO TO 220                                                                 C----- SEQUENTIAL SEARCH LOOP TO FIND INSERTION POINT                             310 DO 320 INSET=JLOW,JHIGH                                                         INDEX=IPERM(INSET)                                                              IF(ANEW.LT.A(INDEX)) GO TO 330                                              320 CONTINUE                                                                        INSET=JHIGH                                                               C-----  SHIFT ORDERED STRING OVER ONE TO MAKE ROOM FOR NEW VALUE                C-----  LOOK FOR SHORTER SHIFT                                                    330 JLOW=INSET-IONE                                                                 JHIGH=ITWO-INSET                                                                IF(JLOW.LT.JHIGH) GO TO 350                                               C-----  CODE TO SHIFT UP -- INSERT IS CLOSER TO ITWO                                  JHIGH=ITWO+1                                                                    DO 340 ITEMP=INSET,ITWO                                                         JLOW=JHIGH-1                                                                    IPERM(JHIGH)=IPERM(JLOW)                                                    340 JHIGH=JLOW                                                                      ITWO=ITWO+1                                                                     GO TO 370                                                                 C-----  CODE TO SHIFT DOWN -- INSERT IS CLOSER TO IONE                            350 INSET=INSET-1                                                                   JLOW=IONE-1                                                                     DO 360 ITEMP=IONE,INSET                                                         JHIGH=JLOW+1                                                                    IPERM(JLOW)=IPERM(JHIGH)                                                    360 JLOW=JHIGH                                                                      IONE=IONE-1                                                               C-----  INSERT NEW VALUE                                                          370 IPERM(INSET)=NEW                                                                GO TO 110                                                                 C-----  SHIFT DOWN TO RETURN IPERM                                                410 JLOW=1                                                                          DO 420 ITEMP=IONE,ITWO                                                          IPERM(JLOW)=IPERM(ITEMP)                                                    420 JLOW=JLOW+1                                                                     IF(N.GT.0) GO TO 900                                                      C----- REVERSE PERMUTATION FOR HI-TO-LO ORDER                                         INSET=NLAST/2                                                                   JHIGH=NLAST                                                                     DO 430 JLOW=1,INSET                                                             ITEMP=IPERM(JHIGH)                                                              IPERM(JHIGH)=IPERM(JLOW)                                                        IPERM(JLOW)=ITEMP                                                           430 JHIGH=JHIGH-1                                                               900 RETURN                                                                          END                                                                       